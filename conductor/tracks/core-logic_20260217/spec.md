# Specification: Core Booking Logic

**Track ID:** core-logic_20260217
**Type:** Feature
**Created:** 2026-02-17
**Status:** Draft

## Summary
Implementación de la lógica central de reservas con alta concurrencia. El objetivo es asegurar que el inventario se descuente de forma atómica y segura, utilizando bloqueos distribuidos (Redlock) para prevenir el overbooking.

## Context
Tras configurar la infraestructura base, este track aborda el problema principal del negocio: la integridad de las reservas bajo carga. Utilizaremos el wrapper de caché para implementar semáforos distribuidos.

## User Story
Como hotelero, quiero que el sistema valide y reserve stock de forma atómica para que nunca se vendan más habitaciones de las disponibles, incluso si miles de personas intentan reservar el mismo recurso al mismo tiempo.

## Acceptance Criteria
- [ ] API de Inventario funcional para inicializar stock de recursos.
- [ ] Lógica de reserva que implementa el patrón Redlock a través del `ICacheService`.
- [ ] Uso de transacciones de base de datos para asegurar que el descuento de stock y la creación de la reserva sean atómicos.
- [ ] Manejo de errores para bloqueos fallidos (Retry pattern básico o rechazo inmediato).
- [ ] Tests de concurrencia unitarios/integración que simulen procesos competitivos.

## Dependencies
- `infra-setup_20260216` (Completado).

## Out of Scope
- Integración con pasarelas de pago reales (sólo mock/estado).
- Notificaciones por email/SMS.
- UI de usuario final.

---

_Generated by Conductor._
